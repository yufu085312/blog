---
title: "喫煙所サーチを個人開発してみた｜Next.js×Firebase×Leafletで作る位置情報アプリ"
date: 2025-12-28T17:34:00+09:00
lastmod: 2026-01-27T22:43:00+09:00
draft: true
description: "Next.js・Firebase・Leafletを使って、喫煙所情報を共有できるWebアプリ「喫煙所サーチ」を個人開発しました。設計、実装、パフォーマンス最適化、直面した課題と解決策を実務視点で解説します。"
summary: "Next.js / Firebase / Leaflet.js を使って、喫煙所情報を共有できる位置情報Webアプリを個人開発しました。設計から実装、課題と改善点までをまとめます。"
categories: ["個人開発", "Web開発"]
tags: ["Next.js", "Firebase", "Leaflet", "位置情報", "地図アプリ", "個人開発", "フロントエンド"]
showSummary: true
showHero: true
---

{{< lead >}}
喫煙者にとって、外出先で喫煙所を探すのは意外とストレスの多い作業です。  
地図アプリで検索しても情報が古かったり、実際には使えなかったりすることも少なくありません。

「もっと正確で、みんなで更新できる喫煙所マップがあれば便利なのに」  
そう思ったことが、このアプリ開発のきっかけでした。
{{< /lead >}}

そこで今回、誰でも喫煙所の位置情報を地図上で確認・共有できるWebアプリ
**「喫煙所サーチ」** を個人開発しました。

この記事では、Next.js / Firebase / Leaflet.js を使ったアプリ開発の全体像と、
実装時に工夫したポイント、直面した課題とその解決策について詳しく紹介します。

---

## アプリの概要

「喫煙所サーチ」 は、地図を中心としたコミュニティ型の位置情報共有Webアプリです。
ユーザー自身が喫煙所情報を投稿・編集できることを特徴としています。

### 主な機能

{{< alert icon="list" >}}
- **📍 地図上での喫煙所検索**: OpenStreetMapを利用し、現在地周辺の喫煙所を表示
- **➕ 喫煙所の新規追加**: ユーザーが自由に位置情報を投稿可能
- **🎯 直感的な位置指定UI**: 地図中央に固定されたピンで位置を指定（モバイルフレンドリー）
- **🔐 ユーザー認証**: Firebase Authenticationによる安全なログイン（Google認証対応）
- **📱 レスポンシブ対応**: PC・スマートフォンの両方で快適に利用可能
- **📝 メモ機能**: 「屋外」「灰皿あり」などの補足情報を追加可能
{{< /alert >}}

---

## 技術スタック

今回の開発で使用した主要な技術です。

### フロントエンド
- **Next.js 14（App Router）**
- **TypeScript**：型安全な開発
- **Tailwind CSS**：高速かつ一貫したスタイリング
- **Leaflet.js / React Leaflet**：地図描画と操作

### バックエンド・インフラ
- **Firebase**
    - **Firestore**：喫煙所データの保存
    - **Authentication**：ユーザー認証
- **Vercel**：デプロイ・ホスティング
- **Docker**：開発環境の統一

---

## 開発のポイント

### 1. ビューポートベース取得によるパフォーマンス最適化

当初は、全ての喫煙所データを一度に取得していました。
しかし、Firebaseの無料枠とパフォーマンスを考慮し、**地図表示範囲内のデータのみ取得する方式**へ変更しました。

```javascript
const q = query(
  collection(db, SMOKING_AREAS_COLLECTION),
  where('latitude', '>=', minLat),
  where('latitude', '<=', maxLat)
);
```

{{< alert icon="check-circle" >}}
**その結果：**
- Firestoreの読み取り回数を大幅削減
- 地図操作時のレスポンス向上
- 無料枠内での安定運用が可能
{{< /alert >}}

### 2. 直感的な位置指定UIへの改善

従来の「地図をクリックして指定」方式では、特にスマホで誤操作が起きやすい問題がありました。
そこで、**地図中央に固定ピンを置き、地図を動かして位置を合わせる方式**に変更しました。

**改善効果：**
- モバイル操作性が大幅に向上
- 指定位置のズレを解消
- より正確な投稿が可能に

### 3. セキュリティとプライバシーへの配慮
- 利用規約・プライバシーポリシーの整備
- 投稿時の注意事項を明示
- Firebase Security Rules によるデータ保護

### 4. モバイルファーストなデザイン
- タッチ操作前提のボタン配置
- 画面サイズに応じたレイアウト切替
- レスポンシブなメッセージUI

---

## 技術的な課題と解決策

### 課題1：Firestoreの複合クエリ制約
Firestoreでは、緯度・経度の両方を範囲指定することができません。

- **解決策：**
    - Firestore側：緯度のみで絞り込み
    - クライアント側：経度をJavaScriptでフィルタリング
- これにより、複合インデックス不要で効率的な取得を実現しました。

### 課題2：SSRとLeafletの互換性
LeafletはDOM APIに依存するため、Next.jsのSSRと衝突します。

- **解決策：**
```javascript
const MapComponent = dynamic(
  () => import('@/components/MapComponent'),
  { ssr: false }
);
```
- 動的インポートで **クライアントサイド限定描画** に切り替えました。

### 課題3：カスタムピンのデザイン
既存喫煙所と追加予定地を視覚的に区別する必要がありました。

- **解決策：**
    - CSSで3D風カスタムピンを実装
    - グラデーション＋シャドウで立体感を演出
    - 色変更のみでテーマ切替可能な設計

---

## デプロイとCI/CD

- **Vercel**: プレビュー環境 / 本番環境の自動デプロイ
- **Docker**: ローカル開発環境の統一
- **GitHub**: PRベースのレビュー・マージ運用

---

## 今後の展開

今後、以下の機能追加を検討しています。

- 🔍 住所・駅名検索
- ⭐ ユーザー評価システム
- 📸 喫煙所の画像投稿
- 🗺️ 現在地からのルート案内

---

## まとめ

Next.js、Firebase、Leaflet.jsを組み合わせることで、
ユーザーフレンドリーな位置情報共有アプリを構築できました。

{{< alert icon="star" >}}
**特に学びが大きかった点は以下です：**
1. パフォーマンス最適化：ビューポートベース取得
2. UX改善：モバイルファースト設計
3. コスト管理：Firebase無料枠の最大活用
{{< /alert >}}

このアプリが、喫煙者の皆さんの日常を少しでも快適にできれば嬉しいです。

{{< button href="https://smoking.yu-fu.site" >}}
アプリを使ってみる
{{< /button >}}
